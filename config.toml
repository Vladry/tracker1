[detector]
# Включает детектор движения. В текущем ручном режиме отслеживания не используется.
use_motion = false

# Включает использование RKNN-детектора. Значение true пытается загрузить модель и использовать NPU. Значение false отключает детекцию, оставляя только трекер. Полезно для тестов производительности и UI без инференса. Если включено, при ошибке загрузки детектор отключится автоматически.
use_rknn = false

# Путь к файлу модели RKNN. Путь может быть относительным или абсолютным, и считается от рабочей директории запуска. Если файл не найден, загрузка конфигурации завершится ошибкой. Убедитесь, что модель скопирована рядом с бинарником или укажите полный путь. Для нескольких моделей меняйте только этот параметр.
rknn_model_path = "models/yolov8n_fp16.rknn"

# Коэффициент масштабирования входного изображения. Значение 1/255 нормализует вход в диапазон 0..1. Если модель ожидает другое масштабирование, меняйте этот параметр. При неверном масштабе точность сильно ухудшается. Используйте значение из пайплайна обучения модели.
rknn_scale = 0.0039215686

# Переключает порядок каналов BGR↔RGB. Включайте true, если модель обучалась на RGB. Оставляйте false, если модель ожидает BGR. Неверный порядок каналов приводит к отсутствию детекций. Проверьте порядок в вашем конвертере RKNN.
rknn_swap_rb = true

# Порог уверенности детекции. Чем ниже значение, тем больше ложных срабатываний. Чем выше значение, тем меньше пропусков, но больше «тишины». Для ночных сцен часто требуется уменьшение порога. Начните с 0.15–0.25 и подберите под свою камеру.
rknn_conf_threshold = 0.05

# Порог NMS для подавления перекрывающихся боксов. Меньшее значение сильнее объединяет боксы. Большее значение допускает больше боксов на один объект. Для плотных сцен увелиивайте, для шума уменьшайте. Параметр влияет на стабильность трекинга.
rknn_nms_threshold = 0.45

# Фильтр по классу. Значение -1 принимает все классы модели. Укажите индекс класса, если нужен только один тип объекта. Индексы соответствуют порядку классов в обучении модели. Неправильный индекс приведёт к отсутствию детекций. Используйте -1 для первичной диагностики.
rknn_class_id = -1


[logging]
# Включает логи RTSP-потока (создание, ошибки, остановка).
rtsp_level_logger_on = false

# Логи детекции ручного клика (статическая/динамическая цель + контраст).
manual_detector_level_logger = true

# Логи трекера (старт, потеря, готовность к пере-захвату, пере-захват).
tracker_level_logger = true

# Логи процессов пере-захвата (приоритеты 1/2/3).
reacquire_level_logger = true

# Логи кликов мыши.
mouse_click_logger = true

# Лог окончания формирования образа цели.
target_object_created_logger = true


[motion_detector]
# Количество кадров истории для фоновой модели. Больше значение медленнее
# подстраивается под изменения сцены, но устойчивее к шуму.
history = 500

# Порог вариативности пикселя. Меньше значение чувствительнее к движению.
var_threshold = 16.0

# Обнаружение теней. При true в маске возможны полутоновые пиксели.
detect_shadows = false

# Минимальная площадь движения (в пикселях) для ROI.  (было 600)
min_area = 20

# Минимальная ширина/высота ROI, чтобы отбросить шум.
min_width = 12
min_height = 12

# Размытие маски движения для подавления шума (нечётное значение).
blur_size = 5

# Размер морфологического ядра.
morph_size = 3

# Количество эрозий/дилатаций для стабилизации маски.
erode_iterations = 1
dilate_iterations = 2


[manual_tracker]
# Максимальное количество одновременно отслеживаемых целей.
max_targets = 5

# Дополнительные пиксели, добавляемые к найденному ROI при клике.
click_padding = 6

# Дополнительный допуск для удаления цели при повторном клике.
remove_padding = 6

# Размер квадратного бокса, если flood fill не нашёл явный объект.
fallback_box_size = 40

# Максимально допустимая доля площади кадра для ROI (0..1).
max_area_ratio = 0.1

# Радиус поиска движущейся цели вокруг клика (пиксели).
motion_search_radius = 30

# Порог разницы яркости для поиска движения (0..255).
motion_diff_threshold = 15

# Радиус поиска статической цели вокруг клика (пиксели).
click_search_radius = 40

# Размер квадратной области вокруг клика для анализа движения (пиксели).
click_capture_size = 80

# Количество последующих кадров для анализа движения пикселей.
motion_frames = 3

# Дополнительное расширение bbox при иициализации трекера.
tracker_init_padding = 10

# Минимальный размер bbox для инициализации трекера.
tracker_min_size = 24

# Минимальная амплитуда движения (пиксели) для отбора точек.
motion_min_magnitude = 0.4

# Допуск по направлению движения (градусы).
motion_angle_tolerance_deg = 20.0

# Допуск по модулю смещения (пиксели).
motion_mag_tolerance_px = 3.0

# Минимальная доля движущихся пикселей в bbox для подтверждения трекинга.
tracker_motion_min_ratio = 0.02

# Количество кадров, прежде чем считать bbox потерянным по малому движению.
tracker_motion_grace_frames = 3

# Время жизни bbox после потери (мс).
lost_bbox_ttl_ms = 3000

# Максимальная дистанция для fallback-пере-захвата (приоритет 3).
reacquire_fallback_max_distance_px = 1300

# Радиус ожидания (Калман) для пере-захвата по движению.
reacquire_kalman_radius_px = 120

# Радиус поиска ближайших движущихся целей после ожидания.
reacquire_near_radius_px = 200

# Выравнивать контраст в области клика перед flood fill.
click_equalize = true

# Заливать область flood fill красным с прозрачностью 0.7.
floodfill_fill_overlay = true

# Через сколько секунд убрать красную область выделенного объекта.
overlay_ttl_seconds = 3

# Допуски flood fill по яркости.
floodfill_lo_diff = 20
floodfill_hi_diff = 20

# Минимальный размер ROI для принятия.
min_area = 60
min_width = 6
min_height = 6

# Радиус поиска при попытке повторного захвата по шаблону. (было 60)
search_radius = 300

# Порог совпадения шаблона (0..1) для успешного ре-захвата.
match_threshold = 0.7

# Обновлять шаблон при успешном трекинге.
update_template = true

# Максимальное время (мс) удержания цели при пропаже.
max_lost_ms = 4000

# Автоматически переназначать цель на ближайший трек, если она потеряна.
auto_reacquire_nearest = true

# Задержка (мс) до переназначения потерянной цели.
reacquire_delay_ms = 2000

# Максимальная дистанция (пиксели) до ближайшей цели для переназначения.
reacquire_max_distance_px = 120

# Тип трекера для ручного режима: KCF, CSRT.
tracker_type = "KCF"

# Параметры фильтра Калмана.
kalman_process_noise = 0.01
kalman_measurement_noise = 0.1


[static_detector]
# Максимальное количество статических целей.
max_targets = 5

# Дополнительные пиксели, добавляемые к найденному ROI при клике.
click_padding = 6

# Дополнительный допуск для удаления цели при повторном клике.
remove_padding = 6

# Размер квадратного бокса, если flood fill не нашёл явный объект.
fallback_box_size = 40

# Максимально допустимая доля площади кадра для ROI (0..1).
max_area_ratio = 0.1

# Радиус поиска статической цели вокруг клика (пиксели).
click_search_radius = 40

# Выравнивать контраст в области клика перед flood fill.
click_equalize = true

# Допуски flood fill по яркости.
floodfill_lo_diff = 20
floodfill_hi_diff = 20

# Через сколько секунд убрать жёлтую область выделенного объекта.
overlay_ttl_seconds = 3

# Минимальный размер ROI для принятия.
min_area = 60
min_width = 6
min_height = 6

# Минимальный контраст (stddev) внутри ROI.
min_contrast = 5.0
