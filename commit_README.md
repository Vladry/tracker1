# Изменения в проекте: переход на TOML и улучшение логики static bbox

## Краткое резюме

В данном коммите выполнены два крупных архитектурных изменения:

1. **Вся конфигурация проекта вынесена из `main.cpp` во внешний TOML-файл (`config.toml`)**
2. **Существенно переработан алгоритм перепривязки красного static bounding box (bbox)**  
   при потере исходной динамической цели

Оба изменения направлены на:
- повышение управляемости параметров
- упрощение экспериментов с алгоритмами
- улучшение визуальной и логической стабильности системы

---

## 1. Переход на TOML-конфигурацию

### Что было раньше

Ранее все ключевые параметры системы (detector, merge, tracker, overlay, static rebind)
были захардкожены в `main.cpp` в виде `static constexpr` констант.

Недостатки такого подхода:
- любое изменение требовало пересборки
- `main.cpp` перегружался конфигурационной логикой
- сложно экспериментировать с параметрами
- невозможно хранить разные профили настроек

---

### Что сделано сейчас

Введён внешний конфигурационный файл:

```
config.toml
```

Все параметры системы теперь:
- хранятся в читаемом текстовом виде
- снабжены комментариями на русском языке
- имеют безопасные значения по умолчанию в коде

Загрузка конфигурации осуществляется через:
- структуру `AppConfig`
- модуль `config.h / config.cpp`
- библиотеку **toml++ (header-only)**

---

### Где лежит `config.toml`

Файл `config.toml` хранится в корне проекта и **автоматически копируется**
рядом с бинарником при конфигурации CMake:

```cmake
configure_file(
    ${CMAKE_SOURCE_DIR}/config.toml
    ${CMAKE_BINARY_DIR}/config.toml
    COPYONLY
)
```

---

## 2. Динамические bounding boxes (dynamic bbox)

Динамические bbox:
- создаются детектором движения
- при необходимости объединяются (merge)
- передаются в трекер
- используются как кандидаты для static bbox

Добавлено сглаживание отображения bbox
(скользящее усреднение по последним N кадрам),
что устраняет визуальное мерцание.

---

## 3. Новый алгоритм выбора цели для красного static bbox

При потере родительского dynamic bbox (зеленые)
static bbox (красный) теперь учитывает:

- расстояние до новой цели
- относительный размер цели
- допустимую дистанцию до крупной цели

Выбор выполняется на основе взвешенной оценки,
что повышает устойчивость и смысловую корректность поведения.

(см. файл "алгоритм привязки.docx")
---

## Итог

Изменения улучшают управляемость проекта,
делают алгоритмы более устойчивыми
и подготавливают кодовую базу к дальнейшему развитию.
